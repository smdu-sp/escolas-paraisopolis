generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider  = "mysql"
    url       = env("DATABASE_URL")
}

enum Permissao {
    DEV
    ADM
}

model Usuario {
    id                     String                 @id @default(uuid())
    nome                   String
    email                  String                 @unique
    login                  String                 @unique
    permissao              Permissao              @default(ADM)
    avatar                 String?
    status                 Boolean                @default(true)
    criadoEm               DateTime               @default(now())
    atualizadoEm           DateTime               @default(now()) @updatedAt

    @@map("usuarios")
}

enum Sentido {
    IDA
    VOLTA
}

model Escola {
    id          String   @id @default(uuid())
    nome        String
    endereco    String?
    latitude    Decimal  @db.Decimal(11, 8)
    longitude   Decimal  @db.Decimal(11, 8)
    respostas   Resposta[]

    @@map("escolas")
}

model Resposta {
    id                  String     @id @default(uuid())
    criadoEm            DateTime   @default(now())
    escolaId            String
    escola              Escola     @relation(fields: [escolaId], references: [id])
    temReuniao          Boolean    @default(false)
    pontos              Ponto[]
    criancas            Crianca[]
    transportes         Transporte[]
    acompanhantes       Acompanhante[]
    sentimentos         SentimentoResposta[]
    problemas           Problema[]
    sugestoes           Sugestao[]
    usuarioIdOpcional   String?

    @@index([escolaId])
    @@map("respostas")
}

enum TipoPonto {
    ORIGEM
    REFERENCIA
    REUNIAO
}

model Ponto {
    id          String    @id @default(uuid())
    respostaId  String
    resposta    Resposta  @relation(fields: [respostaId], references: [id])
    tipo        TipoPonto
    nomeLocal   String?
    latitude    Decimal   @db.Decimal(11, 8)
    longitude   Decimal   @db.Decimal(11, 8)
    ordem       Int?

    @@index([respostaId, tipo])
    @@map("pontos")
}

model Crianca {
    id             String    @id @default(uuid())
    respostaId     String
    resposta       Resposta  @relation(fields: [respostaId], references: [id])
    dataNascimento DateTime  @db.Date

    @@map("criancas")
}

model Transporte {
    id             String    @id @default(uuid())
    respostaId     String
    resposta       Resposta  @relation(fields: [respostaId], references: [id])
    sentido        Sentido
    tipoCodigo     String
    descricaoLivre String?

    @@index([respostaId, sentido])
    @@map("transportes")
}

model Acompanhante {
    id             String    @id @default(uuid())
    respostaId     String
    resposta       Resposta  @relation(fields: [respostaId], references: [id])
    tipoCodigo     String
    descricaoLivre String?

    @@index([respostaId])
    @@map("acompanhantes")
}

enum ChaveSentimento {
    RUAS_CALCADAS
    LIXO
    ESGOTO
    SEGURANCA
    VELOCIDADE
}

model MetricaSentimento {
    id        String              @id @default(uuid())
    chave     ChaveSentimento     @unique
    nome      String
    respostas SentimentoResposta[]

    @@map("metricas_sentimento")
}

model SentimentoResposta {
    id          String            @id @default(uuid())
    respostaId  String
    resposta    Resposta          @relation(fields: [respostaId], references: [id])
    metricaId   String
    metrica     MetricaSentimento @relation(fields: [metricaId], references: [id])
    nota        Int               @db.SmallInt

    @@unique([respostaId, metricaId])
    @@map("sentimentos_resposta")
}

model Problema {
    id          String    @id @default(uuid())
    respostaId  String
    resposta    Resposta  @relation(fields: [respostaId], references: [id])
    ordem       Int
    texto       String

    @@map("problemas")
}

model Sugestao {
    id          String    @id @default(uuid())
    respostaId  String
    resposta    Resposta  @relation(fields: [respostaId], references: [id])
    ordem       Int
    texto       String

    @@map("sugestoes")
}
